<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=G4EbXGY4ZixGqqWoQiiRJgiS2qgsnrx6jJbZvH9gofx6Ghv3yjD9eRhfqvix_zP6wGJBCNQQRnRmV9Lcdfen3A);.lst-kix_daxotrlf64xg-8>li:before{content:"\0025c6   "}.lst-kix_bjcff6oskpug-7>li{counter-increment:lst-ctn-kix_bjcff6oskpug-7}.lst-kix_daxotrlf64xg-6>li:before{content:"\0025a0   "}.lst-kix_daxotrlf64xg-5>li:before{content:"\0027a2   "}.lst-kix_daxotrlf64xg-4>li:before{content:"\0025c6   "}.lst-kix_srze0j87zqp-7>li{counter-increment:lst-ctn-kix_srze0j87zqp-7}ol.lst-kix_srze0j87zqp-8.start{counter-reset:lst-ctn-kix_srze0j87zqp-8 0}ol.lst-kix_bjcff6oskpug-7.start{counter-reset:lst-ctn-kix_bjcff6oskpug-7 0}.lst-kix_daxotrlf64xg-3>li:before{content:"\0025cf   "}ol.lst-kix_bjcff6oskpug-4.start{counter-reset:lst-ctn-kix_bjcff6oskpug-4 0}.lst-kix_srze0j87zqp-6>li{counter-increment:lst-ctn-kix_srze0j87zqp-6}.lst-kix_daxotrlf64xg-7>li:before{content:"\0025cf   "}ol.lst-kix_bjcff6oskpug-2{list-style-type:none}ol.lst-kix_bjcff6oskpug-1{list-style-type:none}ol.lst-kix_bjcff6oskpug-4{list-style-type:none}ol.lst-kix_bjcff6oskpug-3{list-style-type:none}ol.lst-kix_bjcff6oskpug-6{list-style-type:none}ol.lst-kix_bjcff6oskpug-5{list-style-type:none}ol.lst-kix_bjcff6oskpug-8{list-style-type:none}ol.lst-kix_bjcff6oskpug-7{list-style-type:none}.lst-kix_bjcff6oskpug-8>li{counter-increment:lst-ctn-kix_bjcff6oskpug-8}ol.lst-kix_srze0j87zqp-2.start{counter-reset:lst-ctn-kix_srze0j87zqp-2 0}.lst-kix_bjcff6oskpug-5>li{counter-increment:lst-ctn-kix_bjcff6oskpug-5}ol.lst-kix_srze0j87zqp-0{list-style-type:none}ol.lst-kix_srze0j87zqp-4{list-style-type:none}ol.lst-kix_srze0j87zqp-3{list-style-type:none}ol.lst-kix_srze0j87zqp-2{list-style-type:none}ol.lst-kix_srze0j87zqp-1{list-style-type:none}ol.lst-kix_srze0j87zqp-5.start{counter-reset:lst-ctn-kix_srze0j87zqp-5 0}ol.lst-kix_srze0j87zqp-8{list-style-type:none}ol.lst-kix_srze0j87zqp-7{list-style-type:none}ol.lst-kix_srze0j87zqp-6{list-style-type:none}ol.lst-kix_srze0j87zqp-5{list-style-type:none}ol.lst-kix_bjcff6oskpug-0{list-style-type:none}.lst-kix_srze0j87zqp-1>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-1,lower-latin) ". "}ul.lst-kix_499ceu9d4klb-7{list-style-type:none}ul.lst-kix_499ceu9d4klb-6{list-style-type:none}ol.lst-kix_srze0j87zqp-3.start{counter-reset:lst-ctn-kix_srze0j87zqp-3 0}ul.lst-kix_499ceu9d4klb-8{list-style-type:none}.lst-kix_srze0j87zqp-3>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-3,decimal) ". "}ul.lst-kix_499ceu9d4klb-3{list-style-type:none}ul.lst-kix_499ceu9d4klb-2{list-style-type:none}.lst-kix_srze0j87zqp-2>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-2,lower-roman) ". "}ul.lst-kix_499ceu9d4klb-5{list-style-type:none}ul.lst-kix_499ceu9d4klb-4{list-style-type:none}ul.lst-kix_499ceu9d4klb-1{list-style-type:none}.lst-kix_srze0j87zqp-5>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-5,lower-roman) ". "}ul.lst-kix_499ceu9d4klb-0{list-style-type:none}ol.lst-kix_bjcff6oskpug-2.start{counter-reset:lst-ctn-kix_bjcff6oskpug-2 0}.lst-kix_srze0j87zqp-4>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-4,lower-latin) ". "}.lst-kix_srze0j87zqp-7>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-7,lower-latin) ". "}.lst-kix_srze0j87zqp-6>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-6,decimal) ". "}.lst-kix_n1f7qyuezz9x-4>li:before{content:"\0025cb   "}.lst-kix_srze0j87zqp-8>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-8,lower-roman) ". "}.lst-kix_srze0j87zqp-5>li{counter-increment:lst-ctn-kix_srze0j87zqp-5}.lst-kix_n1f7qyuezz9x-5>li:before{content:"\0025a0   "}ol.lst-kix_bjcff6oskpug-8.start{counter-reset:lst-ctn-kix_bjcff6oskpug-8 0}ol.lst-kix_srze0j87zqp-4.start{counter-reset:lst-ctn-kix_srze0j87zqp-4 0}ol.lst-kix_bjcff6oskpug-1.start{counter-reset:lst-ctn-kix_bjcff6oskpug-1 0}.lst-kix_srze0j87zqp-2>li{counter-increment:lst-ctn-kix_srze0j87zqp-2}.lst-kix_n1f7qyuezz9x-6>li:before{content:"\0025cf   "}.lst-kix_n1f7qyuezz9x-7>li:before{content:"\0025cb   "}.lst-kix_bjcff6oskpug-3>li{counter-increment:lst-ctn-kix_bjcff6oskpug-3}ul.lst-kix_daxotrlf64xg-8{list-style-type:none}.lst-kix_n1f7qyuezz9x-8>li:before{content:"\0025a0   "}.lst-kix_bjcff6oskpug-0>li{counter-increment:lst-ctn-kix_bjcff6oskpug-0}.lst-kix_bjcff6oskpug-6>li{counter-increment:lst-ctn-kix_bjcff6oskpug-6}.lst-kix_srze0j87zqp-0>li:before{content:"" counter(lst-ctn-kix_srze0j87zqp-0,decimal) ". "}.lst-kix_srze0j87zqp-8>li{counter-increment:lst-ctn-kix_srze0j87zqp-8}ul.lst-kix_n1f7qyuezz9x-5{list-style-type:none}ul.lst-kix_n1f7qyuezz9x-4{list-style-type:none}.lst-kix_499ceu9d4klb-8>li:before{content:"\0025c6   "}ul.lst-kix_n1f7qyuezz9x-3{list-style-type:none}.lst-kix_bjcff6oskpug-1>li{counter-increment:lst-ctn-kix_bjcff6oskpug-1}ul.lst-kix_n1f7qyuezz9x-2{list-style-type:none}ul.lst-kix_n1f7qyuezz9x-1{list-style-type:none}.lst-kix_srze0j87zqp-1>li{counter-increment:lst-ctn-kix_srze0j87zqp-1}ul.lst-kix_n1f7qyuezz9x-0{list-style-type:none}.lst-kix_499ceu9d4klb-6>li:before{content:"\0025a0   "}.lst-kix_499ceu9d4klb-7>li:before{content:"\0025cf   "}.lst-kix_bjcff6oskpug-1>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-1,lower-latin) ". "}.lst-kix_499ceu9d4klb-4>li:before{content:"\0025c6   "}.lst-kix_499ceu9d4klb-5>li:before{content:"\0027a2   "}.lst-kix_bjcff6oskpug-0>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-0,decimal) ". "}ul.lst-kix_daxotrlf64xg-5{list-style-type:none}ul.lst-kix_daxotrlf64xg-4{list-style-type:none}.lst-kix_bjcff6oskpug-5>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-5,lower-roman) ". "}.lst-kix_bjcff6oskpug-6>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-6,decimal) ". "}.lst-kix_srze0j87zqp-0>li{counter-increment:lst-ctn-kix_srze0j87zqp-0}ul.lst-kix_daxotrlf64xg-7{list-style-type:none}ul.lst-kix_daxotrlf64xg-6{list-style-type:none}ol.lst-kix_srze0j87zqp-1.start{counter-reset:lst-ctn-kix_srze0j87zqp-1 0}ul.lst-kix_daxotrlf64xg-1{list-style-type:none}ul.lst-kix_daxotrlf64xg-0{list-style-type:none}ul.lst-kix_daxotrlf64xg-3{list-style-type:none}ul.lst-kix_daxotrlf64xg-2{list-style-type:none}.lst-kix_bjcff6oskpug-2>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-2,lower-roman) ". "}.lst-kix_bjcff6oskpug-3>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-3,decimal) ". "}.lst-kix_bjcff6oskpug-4>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-4,lower-latin) ". "}ul.lst-kix_n1f7qyuezz9x-8{list-style-type:none}ul.lst-kix_n1f7qyuezz9x-7{list-style-type:none}ul.lst-kix_n1f7qyuezz9x-6{list-style-type:none}.lst-kix_n1f7qyuezz9x-3>li:before{content:"\0025cf   "}.lst-kix_n1f7qyuezz9x-1>li:before{content:"\0025cb   "}.lst-kix_n1f7qyuezz9x-2>li:before{content:"\0025a0   "}ol.lst-kix_bjcff6oskpug-3.start{counter-reset:lst-ctn-kix_bjcff6oskpug-3 0}ol.lst-kix_bjcff6oskpug-6.start{counter-reset:lst-ctn-kix_bjcff6oskpug-6 0}.lst-kix_bjcff6oskpug-7>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-7,lower-latin) ". "}.lst-kix_bjcff6oskpug-8>li:before{content:"" counter(lst-ctn-kix_bjcff6oskpug-8,lower-roman) ". "}.lst-kix_n1f7qyuezz9x-0>li:before{content:"\0025cf   "}.lst-kix_499ceu9d4klb-0>li:before{content:"\002756   "}.lst-kix_499ceu9d4klb-1>li:before{content:"\0027a2   "}.lst-kix_499ceu9d4klb-2>li:before{content:"\0025a0   "}.lst-kix_499ceu9d4klb-3>li:before{content:"\0025cf   "}.lst-kix_bjcff6oskpug-2>li{counter-increment:lst-ctn-kix_bjcff6oskpug-2}ol.lst-kix_bjcff6oskpug-0.start{counter-reset:lst-ctn-kix_bjcff6oskpug-0 0}.lst-kix_srze0j87zqp-4>li{counter-increment:lst-ctn-kix_srze0j87zqp-4}.lst-kix_srze0j87zqp-3>li{counter-increment:lst-ctn-kix_srze0j87zqp-3}ol.lst-kix_srze0j87zqp-6.start{counter-reset:lst-ctn-kix_srze0j87zqp-6 0}.lst-kix_bjcff6oskpug-4>li{counter-increment:lst-ctn-kix_bjcff6oskpug-4}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ol.lst-kix_srze0j87zqp-7.start{counter-reset:lst-ctn-kix_srze0j87zqp-7 0}.lst-kix_daxotrlf64xg-0>li:before{content:"\002756   "}ol.lst-kix_srze0j87zqp-0.start{counter-reset:lst-ctn-kix_srze0j87zqp-0 0}ol.lst-kix_bjcff6oskpug-5.start{counter-reset:lst-ctn-kix_bjcff6oskpug-5 0}.lst-kix_daxotrlf64xg-2>li:before{content:"\0025a0   "}.lst-kix_daxotrlf64xg-1>li:before{content:"\0027a2   "}ol{margin:0;padding:0}table td,table th{padding:0}.c0{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#eaeef3;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c9{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c4{color:#1155cc;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Bree Serif";font-style:normal}.c16{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Bree Serif";font-style:normal}.c19{color:#6aa84f;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Times New Roman";font-style:normal}.c3{color:#ff00ff;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Times New Roman";font-style:normal}.c8{color:#3c78d8;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Bree Serif";font-style:normal}.c7{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Alegreya";font-style:normal}.c22{color:#000000;text-decoration:none;vertical-align:baseline;font-size:20pt;font-style:normal}.c2{background-color:#eaeef3;font-family:"Consolas";color:#00193a;font-weight:700}.c6{border-spacing:0;border-collapse:collapse;margin-right:auto}.c21{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:center}.c5{background-color:#eaeef3;font-family:"Consolas";color:#00193a;font-weight:400}.c10{background-color:#eaeef3;font-family:"Consolas";color:#0048ab;font-weight:400}.c12{margin-left:36pt;padding-left:0pt;orphans:2;widows:2}.c11{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c20{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c15{orphans:2;widows:2}.c17{margin-left:72pt;padding-left:0pt}.c18{font-weight:400;font-family:"Alegreya"}.c14{padding:0;margin:0}.c1{height:0pt}.c13{margin-left:36pt}.c23{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c20 doc-content"><p class="c9 c13"><span class="c7"></span></p><p class="c15 c13 c21"><span class="c18 c22">SQL Project on Analyzing the CryptoPunks Dataset</span></p><p class="c21 c15 c13"><span class="c3">Chandrima Khastagir</span></p><p class="c21 c15 c13"><span class="c19">May 20, 2024</span></p><p class="c9 c13"><span class="c7"></span></p><p class="c9 c13"><span class="c7"></span></p><p class="c9 c13"><span class="c7"></span></p><p class="c11 c15 c13"><span class="c7">CryptoPunks is a collection of nonfungible tokens (NFTs) on the Ethereum cryptocurrency blockchain. With the increasing advent of digital platforms and cryptocurrency in our portfolios, a better understanding of such online transactions becomes indispensable. In this project, we use SQL to analyze sales record data for a number of NFTs undertaken on the CryptoPunks platform. We begin with a short description of the columns, before moving onto seeking specific questions about the dataset. The large volume and intricate information style of this database shows the crucial benefit of using SQL to derive valuable data-based insights.</span></p><p class="c9 c13"><span class="c7"></span></p><p class="c21 c15 c13"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 248.00px; height: 165.33px;"><img alt="" src="images/image14.png" style="width: 248.00px; height: 165.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c21 c15 c13 c23"><span class="c7"></span></p><p class="c9 c13"><span class="c7"></span></p><p class="c11 c15 c13"><span class="c7">The CryptoPunks dataset has information about NFT sales described through 8 different columns:</span></p><p class="c9 c13"><span class="c7"></span></p><ul class="c14 lst-kix_499ceu9d4klb-0 start"><li class="c11 c15 c17 li-bullet-0"><span class="c7">buyer_address</span></li><li class="c11 c15 c17 li-bullet-0"><span class="c7">eth_price (price in Ethereum)</span></li><li class="c11 c15 c17 li-bullet-0"><span class="c7">usd_price (price in USD)</span></li><li class="c11 c15 c17 li-bullet-0"><span class="c7">seller_address</span></li><li class="c11 c15 c17 li-bullet-0"><span class="c7">event_date (date of the sale)</span></li><li class="c11 c15 c17 li-bullet-0"><span class="c7">token_id</span></li><li class="c11 c15 c17 li-bullet-0"><span class="c7">transaction_hash</span></li><li class="c11 c15 c17 li-bullet-0"><span class="c7">name</span></li></ul><p class="c11 c15"><span class="c7">We will now understand the dataset better through a series of targeted questions. Let us start with the basics, by figuring out the volume of available sales information.</span></p><ol class="c14 lst-kix_bjcff6oskpug-0 start" start="1"><li class="c12 c11 li-bullet-0"><span class="c8">How many sales occurred during this time period?</span></li></ol><p class="c9"><span class="c16"></span></p><p class="c11 c15"><span class="c18">The dataset describes one sale in each row. Thus, to answer this question, we start with looking for the number of rows in the dataset, which can be done by:</span><span class="c16">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c9"><span class="c16"></span></p><a id="t.d88450e7e4aecce4e90f7feb9e9ce68057411f4d"></a><a id="t.0"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">COUNT</span><span class="c5">(*) </span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">The above code has the output:</span></p><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 166.00px; height: 73.00px;"><img alt="" src="images/image5.png" style="width: 166.00px; height: 73.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c15"><span class="c18">meaning that there are 19920 sales recorded in the dataset.</span></p><p class="c9"><span class="c16"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="2"><li class="c12 c11 li-bullet-0"><span class="c8">Return the top 5 most expensive transactions (by USD price) for this data set.Return the name, ETH price, and USD price, as well as the date.</span></li></ol><p class="c9"><span class="c16"></span></p><p class="c11 c15"><span class="c7">Let us first understand which rows would be featured. Clearly, we need to sort the rows by USD price in the decreasing order and choose the top 5 among them. In SQL, this is done through ORDER BY and LIMIT commands. Now choosing the desired columns, we end up with the query:</span></p><a id="t.678e81d14cc20236d1d6ea5a32ab45ef373d41dc"></a><a id="t.1"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5">, eth_price, usd_price, event_date </span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c10">date</span><span class="c5"><br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;usd_price </span><span class="c2">DESC</span><span class="c5"><br></span><span class="c2">LIMIT</span><span class="c5">&nbsp;5</span></p></td></tr></table><p class="c9"><span class="c16"></span></p><p class="c11 c15"><span class="c7">This query gave the output:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 513.00px; height: 159.00px;"><img alt="" src="images/image3.png" style="width: 513.00px; height: 159.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c15"><span class="c7">returning exactly the rows and columns we were seeking.</span></p><p class="c9"><span class="c16"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="3"><li class="c12 c11 li-bullet-0"><span class="c8">Return a table with a row for each transaction with an event column, a USD price column, and a moving average of USD price that averages the last 50 transactions.</span></li></ol><p class="c9"><span class="c4"></span></p><p class="c11 c15"><span class="c18">To determine the moving average, we will have to average the USD price over the last 50 transactions ordered by event date. This requires a special syntax asking SQL to determine the rows between the two specified endpoints: start at the 49th preceding row, and end at the current row. Once this is settled, the rest of the query is straightforward.</span></p><p class="c9"><span class="c16"></span></p><a id="t.0a994c2f806d8d318d9db9a2e3fd6036827abfc2"></a><a id="t.2"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;event_date, usd_price, </span><span class="c2">AVG</span><span class="c5">(usd_price) </span><span class="c2">OVER</span><span class="c5">&nbsp;(</span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;event_date </span><span class="c2">ASC</span><span class="c5">&nbsp;</span><span class="c2">ROWS</span><span class="c5">&nbsp;</span><span class="c2">BETWEEN</span><span class="c5">&nbsp;49 </span><span class="c2">PRECEDING</span><span class="c5">&nbsp;</span><span class="c2">AND</span><span class="c5">&nbsp;</span><span class="c2">CURRENT</span><span class="c5">&nbsp;</span><span class="c2">ROW</span><span class="c5">) </span><span class="c2">AS</span><span class="c5">&nbsp;moving_avg<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span></p></td></tr></table><p class="c9"><span class="c16"></span></p><p class="c11 c15"><span class="c7">A partial output is as follows:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 396.00px; height: 220.00px;"><img alt="" src="images/image12.png" style="width: 396.00px; height: 220.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c18">Clearly, the very first transaction had no preceding row and its value coincides with the moving average.</span></p><p class="c9"><span class="c16"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="4"><li class="c12 c11 li-bullet-0"><span class="c8">Return all the NFT names and their average sale price in USD. Sort descending. Name the average column as average_price.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">This question can be broken into two simple parts. First we have to calculate the average sale price in USD by grouping over the name of the NFT: in SQL syntax, this points to a use of GROUP BY. Second, we need to sort the rows according to the average price in a descending order.</span></p><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">The following code block writes the required SQL code to carry out this operation.</span></p><p class="c9"><span class="c7"></span></p><a id="t.63e35a71ea02559d1c569caf43329a9598b766bb"></a><a id="t.3"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5">, </span><span class="c2">AVG</span><span class="c5">(usd_price) </span><span class="c2">AS</span><span class="c5">&nbsp;average_price<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5"><br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;average_price </span><span class="c2">DESC</span></p></td></tr></table><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">A partial output is given by:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 361.00px; height: 214.00px;"><img alt="" src="images/image1.png" style="width: 361.00px; height: 214.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c7">.</span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="5"><li class="c12 c11 li-bullet-0"><span class="c8">Return each day of the week and the number of sales that occurred on that day of the week, as well as the average price in ETH. Order by the count of transactions in ascending order.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">Note that for each sale we have information on the event_date. Our first task will be to create a column which converts the event_date to the corresponding day of the week, which is achieved through the DAYNAME function in SQL. Once this is completed, we will use GROUP BY to count the number of sales, and the average price in ETH over all sales occurring for that day of the week. An ascending order sorting, via ORDER BY applied on the count column will then get the job done!</span></p><p class="c9"><span class="c7"></span></p><a id="t.ed554826c137d18c835e61dbfe4c7a895b27362f"></a><a id="t.4"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">DAYNAME</span><span class="c5">(event_date) </span><span class="c2">AS</span><span class="c5">&nbsp;day_of_week, </span><span class="c2">COUNT</span><span class="c5">(*) </span><span class="c2">AS</span><span class="c5">&nbsp;no_of_sales, </span><span class="c2">AVG</span><span class="c5">(eth_price) </span><span class="c2">AS</span><span class="c5">&nbsp;avg_eth_price<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;day_of_week<br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;no_of_sales </span><span class="c2">ASC</span></p></td></tr></table><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">We have the following output as a result of this code:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 435.00px; height: 217.00px;"><img alt="" src="images/image8.png" style="width: 435.00px; height: 217.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c15"><span class="c7">The most sales occur on Monday and Friday, and the lowest are in the middle of the week.</span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="6"><li class="c12 c11 li-bullet-0"><span class="c8">Construct a column that describes each sale and is called summary. The sentence should include who sold the NFT name, who bought the NFT, who sold the NFT,the date, and what price it was sold for in USD rounded to the nearest thousandth.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">This question requires string handling in SQL. For each row, which represents a sale, we have the NFT name, the ids of the buyer and the seller coded by buyer_address and seller_address respectively. Rounding the USD price can be done through the ROUND function, with -3 to specify 3 places after the decimal. Finally, the CONCAT command can be used to write a sentence that concatenates the required information.</span></p><p class="c9"><span class="c7"></span></p><a id="t.da79f4f25afdf522c224d84b87c87917c5606810"></a><a id="t.5"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">CONCAT</span><span class="c5">(</span><span class="c2">name</span><span class="c5">, </span><span class="c10">&#39;was sold for $&#39;</span><span class="c5">, </span><span class="c2">ROUND</span><span class="c5">(usd_price, 3), <br></span><span class="c10">&#39; to &#39;</span><span class="c5">, buyer_address, </span><span class="c10">&#39; by &#39;</span><span class="c5">, seller_address, </span><span class="c10">&#39; on &#39;</span><span class="c5">, event_date, </span><span class="c10">&#39;.&#39;</span><span class="c5">) </span><span class="c2">AS</span><span class="c5">&nbsp;summary<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">For example, the second row of the output reads:</span></p><a id="t.5e8f2f03b1d3389f3e00e3a4addc0dafb3ff3855"></a><a id="t.6"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c5">&#39;CryptoPunk #3874was sold for $207300.32 to 0xafa796c9de9b22b46f0dc1922fe017582c5e10b5 by 0x1919db36ca2fa2e15f9000fd9cdc2edcf863e685 on 2022-01-14.&#39;</span></p></td></tr></table><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">and the fourth row reads:</span></p><a id="t.a3d9e1d0db63270c51e1e3692b09329eaeedaf68"></a><a id="t.7"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c5">&#39;CryptoPunk #5231was sold for $220266.72 to 0x3e8faf5b3a4ef575a329f8c976ff27f286ab2643 by 0x44a3ccddccae339d05200a8f4347f83a58847e52 on 2022-01-14.&#39;</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="7"><li class="c12 c11 li-bullet-0"><span class="c8">Create a view called &ldquo;1919_purchases&rdquo; and contains any sales where&ldquo;0x1919db36ca2fa2e15f9000fd9cdc2edcf863e685&rdquo; was the buyer.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">A view is a temporary table that is sometimes useful in local data visualization. In this case we use a view to isolate the sales a particular buyer was part of. The SQL syntax for this code is:</span></p><p class="c9"><span class="c7"></span></p><a id="t.b82d659737de1735518e67a9532cd4882ed4e274"></a><a id="t.8"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">CREATE</span><span class="c5">&nbsp;</span><span class="c2">VIEW</span><span class="c5">&nbsp;1919_purchases </span><span class="c2">AS</span><span class="c5"><br></span><span class="c2">SELECT</span><span class="c5">&nbsp;* </span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">WHERE</span><span class="c5">&nbsp;buyer_address = 0x1919db36ca2fa2e15f9000fd9cdc2edcf863e685</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">As expected, this creates a view with all columns and the corresponding rows in our schema:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 293.50px; height: 249.00px;"><img alt="" src="images/image2.png" style="width: 293.50px; height: 249.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c8"></span></p><p class="c9"><span class="c8"></span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="8"><li class="c12 c11 li-bullet-0"><span class="c8">Create a histogram of ETH price ranges. Round to the nearest hundred value.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">A quick look through the table using the MIN and MAX functions reveals that the eth_price value ranges from 0 to 4200. We will use binning into buckets of size 100. The SQL code below does exactly this, and returns the frequency counts for each bin.</span></p><p class="c9"><span class="c7"></span></p><a id="t.7fdae20b4c4d94e91bf234daaae64493c9c6af8e"></a><a id="t.9"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">CONCAT</span><span class="c5">(</span><span class="c2">ROUND</span><span class="c5">(eth_price, -2),</span><span class="c10">&#39;-&#39;</span><span class="c5">, </span><span class="c2">LEAD</span><span class="c5">(</span><span class="c2">ROUND</span><span class="c5">(eth_price, -2)) </span><span class="c2">OVER</span><span class="c5">&nbsp;(</span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">ROUND</span><span class="c5">(eth_price, -2))) </span><span class="c2">AS</span><span class="c5">&nbsp;bins,<br></span><span class="c2">COUNT</span><span class="c5">(*) </span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">count</span><span class="c5"><br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">ROUND</span><span class="c5">(eth_price, -2)<br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">ROUND</span><span class="c5">(eth_price, -2) </span><span class="c2">ASC</span></p></td></tr></table><p class="c11 c15"><span class="c7">A partial output is as follows:</span></p><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 171.00px; height: 244.00px;"><img alt="" src="images/image13.png" style="width: 171.00px; height: 244.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="9"><li class="c12 c11 li-bullet-0"><span class="c8">Return a unioned query that contains the highest price each NFT was bought for and a new column called status saying &ldquo;highest&rdquo; with a query that has the lowest price each NFT was bought for and the status column saying &ldquo;lowest&rdquo;. The table should have a name column, a price column called price, and a status column. Order the result set by the name of the NFT, and the status, in ascending order.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">We will first use two subqueries to derive the lowest price and the highest price corresponding to each NFT. Then, a Union operation over these two subqueries will give the desired result. As mentioned in the question, we have to then use ORDER BY to sort the rows according to the name and the status.</span></p><p class="c9"><span class="c7"></span></p><a id="t.65d38af050c87f27e0ed8d308b013587d1693ead"></a><a id="t.10"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c5">(</span><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5">, </span><span class="c2">MIN</span><span class="c5">(usd_price) </span><span class="c2">AS</span><span class="c5">&nbsp;price, </span><span class="c10">&#39;lowest&#39;</span><span class="c5">&nbsp;</span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">status</span><span class="c5">&nbsp;<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5">)<br></span><span class="c2">UNION</span><span class="c5">&nbsp;(</span><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5">, </span><span class="c2">MAX</span><span class="c5">(usd_price) </span><span class="c2">AS</span><span class="c5">&nbsp;price, </span><span class="c10">&#39;highest&#39;</span><span class="c5">&nbsp;</span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">status</span><span class="c5">&nbsp;<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5">)<br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">name</span><span class="c5">, </span><span class="c2">status</span><span class="c5">&nbsp;</span><span class="c2">ASC</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">A partial output is as follows:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 372.00px; height: 244.00px;"><img alt="" src="images/image9.png" style="width: 372.00px; height: 244.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c7"></span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="10"><li class="c12 c11 li-bullet-0"><span class="c8">What NFT sold the most each month / year combination? Also, what was the name and the price in USD? Order in chronological format. </span></li></ol><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">Let us first break down the question into its components. First, we extract the month and year combination of every sale from the event_date column. For each such combination, we now need a ranking of the NFTs by total number sold in that period. This can be done through the RANK() function in SQL. The last step requires a filtering to pick only the top sold NFT, usually enforced through a WHERE condition. Since the WHERE condition operates on the newly created RANK column, we will pass the query inside to a subquery. The name and average USD price for each NFT can be derived through a GROUP BY condition. Taken together, the query becomes:</span></p><p class="c9"><span class="c7"></span></p><a id="t.d9990dda84da0cabd16e97f638a946e07c9de31e"></a><a id="t.11"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">year</span><span class="c5">, </span><span class="c2">month</span><span class="c5">, </span><span class="c2">name</span><span class="c5">, avg_price </span><span class="c2">FROM</span><span class="c5">&nbsp;(<br></span><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">YEAR</span><span class="c5">(event_date) </span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">year</span><span class="c5">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </span><span class="c2">MONTH</span><span class="c5">(event_date) </span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">month</span><span class="c5">,<br> &nbsp; &nbsp; &nbsp; </span><span class="c2">name</span><span class="c5">, </span><span class="c2">AVG</span><span class="c5">(usd_price) </span><span class="c2">AS</span><span class="c5">&nbsp;avg_price, <br> &nbsp; &nbsp; &nbsp; </span><span class="c2">RANK</span><span class="c5">() </span><span class="c2">OVER</span><span class="c5">&nbsp;(</span><span class="c2">PARTITION</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">YEAR</span><span class="c5">(event_date), </span><span class="c2">MONTH</span><span class="c5">(event_date) </span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">COUNT</span><span class="c5">(*) </span><span class="c2">DESC</span><span class="c5">) </span><span class="c2">AS</span><span class="c5">&nbsp;rank_most_sold <br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">year</span><span class="c5">, </span><span class="c2">month</span><span class="c5">) </span><span class="c2">AS</span><span class="c5">&nbsp;t<br></span><span class="c2">WHERE</span><span class="c5">&nbsp;t.rank_most_sold = 1<br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">year</span><span class="c5">, </span><span class="c2">month</span><span class="c5">&nbsp;</span><span class="c2">ASC</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">We get the following (truncated) output as a result of the above query:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 487.00px; height: 238.00px;"><img alt="" src="images/image11.png" style="width: 487.00px; height: 238.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c7"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="11"><li class="c12 c11 li-bullet-0"><span class="c8">Return the total volume (sum of all sales), round to the nearest hundred on a monthly basis (month/year).</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">Just as in the previous question, we extract the year and the month information from event_date, then sum over all available sale prices to get the monthly sale figure. This is done through a GROUP BY operation. The sales figure is rounded to the hundred&rsquo;s place using the ROUND function. We use the following query:</span></p><p class="c9"><span class="c7"></span></p><a id="t.1a2f8ad493f8e75311b41011b620314ac06b50e6"></a><a id="t.12"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">YEAR</span><span class="c5">(event_date) </span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">year</span><span class="c5">, </span><span class="c2">MONTH</span><span class="c5">(event_date) </span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">month</span><span class="c5">,<br></span><span class="c2">ROUND</span><span class="c5">(</span><span class="c2">SUM</span><span class="c5">(usd_price), -2) </span><span class="c2">AS</span><span class="c5">&nbsp;sum_monthly_sales<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">year</span><span class="c5">, </span><span class="c2">month</span><span class="c5"><br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;</span><span class="c2">year</span><span class="c5">, </span><span class="c2">month</span><span class="c5">&nbsp;</span><span class="c2">ASC</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">A partial output looks as follows:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 304.00px; height: 241.00px;"><img alt="" src="images/image4.png" style="width: 304.00px; height: 241.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="12"><li class="c12 c11 li-bullet-0"><span class="c8">Count how many transactions the wallet&ldquo;0x1919db36ca2fa2e15f9000fd9cdc2edcf863e685&rdquo;had over this time period.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">We have to find all transactions a particular wallet has been a part of. Note that this wallet can participate either as a buyer or as a seller. Thus, we look for the count of all possible rows where either the buyer or the seller address matches with this wallet id. In SQL syntax this takes the form:</span></p><p class="c9"><span class="c7"></span></p><a id="t.251e3243049c5e869b5fdbd58ff8f866a3f6f00b"></a><a id="t.13"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;</span><span class="c2">COUNT</span><span class="c5">(*)<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">WHERE</span><span class="c5">&nbsp;buyer_address = </span><span class="c10">&#39;0x1919db36ca2fa2e15f9000fd9cdc2edcf863e685&#39;</span><span class="c5">&nbsp;</span><span class="c2">OR</span><span class="c5"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; seller_address = </span><span class="c10">&#39;0x1919db36ca2fa2e15f9000fd9cdc2edcf863e685&#39;</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">This query results in 491 sale records, as reflected below:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 109.00px; height: 63.00px;"><img alt="" src="images/image6.png" style="width: 109.00px; height: 63.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c7"></span></p><p class="c9"><span class="c8"></span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="13"><li class="c11 c12 li-bullet-0"><span class="c8">Create an &ldquo;estimated average value calculator&rdquo; that has a representative price of the collection every day based off of these criteria: Exclude all daily outlier sales where the purchase price is below 10% of the daily average price. Take the daily average of remaining transactions. a) First create a query that will be used as a subquery. Select the event date, the USD price, and the average USD price for each day using a window function. Save it as a temporary table. b) Use the table you created in Part A to filter out rows where the USD price is below 10% of the daily average and return a new estimated value which is just the daily average of the filtered data.</span></li></ol><p class="c9"><span class="c8"></span></p><p class="c11 c15"><span class="c7">We will follow the execution plan given in the question. Let us first define a temporary table with the instructions in part a). This simply requires us to average the USD price using a Windows aggregate function over each event_date.</span></p><p class="c9"><span class="c7"></span></p><a id="t.919bf7ebb55cffab625232def44e362d6fe2c288"></a><a id="t.14"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">CREATE</span><span class="c5">&nbsp;</span><span class="c2">TEMPORARY</span><span class="c5">&nbsp;</span><span class="c2">TABLE</span><span class="c5">&nbsp;avg_daily_price </span><span class="c2">AS</span><span class="c5"><br></span><span class="c2">SELECT</span><span class="c5">&nbsp;event_date, usd_price, </span><span class="c2">AVG</span><span class="c5">(usd_price) </span><span class="c2">OVER</span><span class="c5">&nbsp;(</span><span class="c2">PARTITION</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;event_date) </span><span class="c2">AS</span><span class="c5">&nbsp;avg_daily_price<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks;</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">With the temporary table as defined above, let us now clip observations to be between 90% and 110% of the daily average. After this is done, we calculate the daily average over the observations remaining in the table.</span></p><p class="c9"><span class="c7"></span></p><a id="t.473e1a8cddf83ae141610160a10752c366e31e4e"></a><a id="t.15"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;event_date, </span><span class="c2">AVG</span><span class="c5">(usd_price) </span><span class="c2">AS</span><span class="c5">&nbsp;estimated_avg_daily<br></span><span class="c2">FROM</span><span class="c5">&nbsp;avg_daily_price<br></span><span class="c2">WHERE</span><span class="c5">&nbsp;usd_price &gt; 0.9 * avg_daily_price </span><span class="c2">AND</span><span class="c5">&nbsp;usd_price &lt; 1.1 * avg_daily_price<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;event_date</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">When applied together, the above two queries produce an output of the form:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 235.83px; height: 185.20px;"><img alt="" src="images/image10.png" style="width: 235.83px; height: 185.20px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c8"></span></p><p class="c9"><span class="c8"></span></p><ol class="c14 lst-kix_bjcff6oskpug-0" start="14"><li class="c12 c11 li-bullet-0"><span class="c8">Give a complete list ordered by wallet profitability (whether people have made or lost money).</span></li></ol><p class="c9 c13"><span class="c16"></span></p><p class="c9 c13"><span class="c16"></span></p><p class="c11 c15"><span class="c7">For each wallet, we first derive its total selling price and total buying price. We will then compute the profit for each wallet and order the rows according to profit. This leads to the SQL query:</span></p><p class="c9"><span class="c7"></span></p><a id="t.9b0234c311807569bb21a6c2d639d0980cd8b0d8"></a><a id="t.16"></a><table class="c6"><tr class="c1"><td class="c0" colspan="1" rowspan="1"><p class="c11"><span class="c2">SELECT</span><span class="c5">&nbsp;t1.buyer_address </span><span class="c2">AS</span><span class="c5">&nbsp;</span><span class="c2">wallet</span><span class="c5">, </span><span class="c2">ROUND</span><span class="c5">(total_selling_price - total_buying_price,2) </span><span class="c2">AS</span><span class="c5">&nbsp;profit <br></span><span class="c2">FROM</span><span class="c5"><br>(</span><span class="c2">SELECT</span><span class="c5">&nbsp;buyer_address, </span><span class="c2">SUM</span><span class="c5">(usd_price) </span><span class="c2">AS</span><span class="c5">&nbsp;total_buying_price<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;buyer_address) t1<br></span><span class="c2">JOIN</span><span class="c5">&nbsp;<br>(</span><span class="c2">SELECT</span><span class="c5">&nbsp;seller_address, </span><span class="c2">SUM</span><span class="c5">(usd_price) </span><span class="c2">AS</span><span class="c5">&nbsp;total_selling_price<br></span><span class="c2">FROM</span><span class="c5">&nbsp;cryptopunks<br></span><span class="c2">GROUP</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;seller_address) t2<br></span><span class="c2">ON</span><span class="c5">&nbsp;t1.buyer_address = t2.seller_address<br></span><span class="c2">ORDER</span><span class="c5">&nbsp;</span><span class="c2">BY</span><span class="c5">&nbsp;profit </span><span class="c2">ASC</span></p></td></tr></table><p class="c9"><span class="c7"></span></p><p class="c11 c15"><span class="c7">A partial output is shown below:</span></p><p class="c11 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 473.25px; height: 217.50px;"><img alt="" src="images/image7.png" style="width: 473.25px; height: 217.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c7"></span></p><p class="c9"><span class="c16"></span></p></body></html>